{
  "info": {
    "_postman_id": "21653aee-d654-4061-873c-914d7823697e",
    "name": "Backend2 - Clase 4 (JWT + Passport)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "chatgpt"
  },
  "item": [
    {
      "name": "Health",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "health"
          ]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status is 200', () => pm.response.code === 200);",
              "pm.test('ok:true', () => pm.response.json().ok === true);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Auth / Register (user)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"first_name\": \"{{user_first_name}}\",\n  \"last_name\": \"{{user_last_name}}\",\n  \"age\": \"{{user_age}}\",\n  \"email\": \"{{user_email}}\",\n  \"password\": \"{{user_password}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/sessions/register",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "sessions",
            "register"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Created 201', () => pm.response.code === 201);",
              "pm.test('Returns id', () => pm.response.json().id);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Auth / Login (user \u2192 cookie)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{user_email}}\",\n  \"password\": \"{{user_password}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/sessions/login",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "sessions",
            "login"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('OK 200', () => pm.response.code === 200);",
              "// Cookie jar maneja la cookie HttpOnly autom\u00e1ticamente",
              "pm.test('Cookie currentUser seteada', () => pm.cookies.has(pm.environment.get('cookie_name')));"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Sessions / Current (cookie)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/sessions/current",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "sessions",
            "current"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('OK 200', () => pm.response.code === 200);",
              "const j = pm.response.json();",
              "pm.test('Tiene user.id/email/role', () => j.user && j.user.id && j.user.email && j.user.role);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Auth / Logout (borra cookie)",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/api/sessions/logout",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "sessions",
            "logout"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('OK 200', () => pm.response.code === 200);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Private / Ping (cookie o Bearer)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/private/ping",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "private",
            "ping"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('OK 200', () => pm.response.code === 200);",
              "pm.test('ok:true', () => pm.response.json().ok === true);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Private / Admin Ping (rol admin)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/private/admin-ping",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "private",
            "admin-ping"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('OK 200', () => pm.response.code === 200 || pm.response.code === 403);",
              "if (pm.response.code === 200) pm.test('ok:true', () => pm.response.json().ok === true);",
              "if (pm.response.code === 403) pm.test('Forbidden', () => pm.response.json().error);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Auth / Register (admin shortcut)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"first_name\": \"Admin\",\n  \"last_name\": \"Coder\",\n  \"age\": 30,\n  \"email\": \"{{admin_email}}\",\n  \"password\": \"{{admin_password}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/sessions/register",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "sessions",
            "register"
          ]
        }
      }
    },
    {
      "name": "Auth / Login (admin \u2192 cookie)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"{{admin_email}}\",\n  \"password\": \"{{admin_password}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/api/sessions/login",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "api",
            "sessions",
            "login"
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('OK 200', () => pm.response.code === 200);",
              "pm.test('Cookie currentUser presente', () => pm.cookies.has(pm.environment.get('cookie_name')));"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "event": []
}